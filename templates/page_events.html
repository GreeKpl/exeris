{% extends "page_base.html" %}
{% block title %} {{ t("title_page_events") }} {% endblock %}
{% block content %}
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <button type="button" class="btn btn-default navbar-btn">Community</button>
            <button type="button" class="btn btn-default navbar-btn">Char 1</button>
            <button type="button" class="btn btn-default navbar-btn">Char 2</button>
            <button type="button" class="btn btn-default navbar-btn">Char 3</button>
        </div>
    </nav>
    <div class="row">
        <br><br><br>
    </div>
    <div class="row">
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="message">Message</label>
                    <input type="text" class="form-control" id="message" placeholder="Your message here">
                </div>
                <button type="submit" id="say_it" class="btn btn-default">Say it!</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8">
            <div class="events_list_view">
                <div class="no_top_bar"></div>
                <div class="events_list_view_contents">
                    <ol>
                    </ol>
                </div>
            </div>
        </div>
        <div class="col-md-4">
{#            <div class="panel panel-default">#}
{#                <div class="panel-heading">{{ t("title_page_events_people") }}</div>#}
{#                <div class="list-group">#}
{#                    {% for id, name in chars %}#}
{#                        <a href="#" class="slap-char list-group-item" data-target="{{ id }}">{{ name }}</a>#}
{#                    {% endfor %}#}
{#                </div>#}
{#            </div>#}
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript">

    var _last_event = 0;

    $(function() {
        EVENTS.update_events = function(new_events, last_event) {
            for (var i = 0; i < new_events.length; i++) {
                new_events[i] = new_events[i].replace(/(\*+[^*]+\*+)/g, "<b>$1</b>");
                $(".events_list_view_contents > ol").prepend("<li>" + new_events[i] + "</li>");
            }
            _last_event = last_event;
        };

        // Proposal
        // maybe something like that:
        // FRAGMENTS.events.update_events = ...
        // defined in a fragment-specific file

        $(EVENTS).on("events_refresh", function() {
            Sijax.request("update_events", [_last_event]);
        });

        $(document).on("click", "#say_it", function(event) {
            event.preventDefault();
            var message = $("#message");
            var message_text = message.val().trim();
            if (message_text) {
                Sijax.request("say_aloud", [message_text]);
                message.val("");
            }
        });

        EVENTS.trigger("events_refresh");
        setInterval(function() {
            EVENTS.trigger("events_refresh");
        }, 3000);
    });
    </script>
{% endblock %}
